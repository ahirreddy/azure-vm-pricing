# Azure VM pricing

## Parser

Retrieve `VMs` **hourly** pricing for a specific **culture**, **currency**, **operating system** and **region**.

### Parser pre-requisites

- `Node.js 8.12`
- `Yarn 1.13.0`

```posh
cd .\parser\
yarn
```

### Parser usage

```posh
cd .\parser\
yarn crawl --currency USD --culture en-us --operating-system linux --region us-west
```

You can also use short names:

```posh
yarn crawl -c USD -l en-us -o linux -r us-west
```

Arguments:

- `currency` any of the `option` `value` in the **Currency** `select`
- `culture` any of the `option` `value` in the **Culture** `select`
  - **This will impact the formatting of the pricing**
- `operating-system` any of the `option` `value` in the **OS/Software** `select`
- `region` any of the `option` `value` in the **Region** `select`

![OS and Region select](docs/assets/os-region.png)

In the footer:

![Culture and Currency select](docs/assets/culture-currency.png)

### Parser output

Writes `2` output files in the `out` directory. One is a `CSV`, the other one is `JSON`. Both files contain the same data.

```text
.\out\vm-pricing_<region>_<operating-system>.csv
.\out\vm-pricing_<region>_<operating-system>.json
```

Fields:

- `Instance`
- `vCPU`
- `RAM`
- `Pay as You Go`
- `One Year Reserved`
- `Three Year Reserved`
- `Three Year Reserved With Azure Hybrid Benefit`

## Coster

Price `VMs` using the `JSON` pricing files generated by the `Parser`. The `Coster` will select the cheapest `VM` that has enough `CPU` cores and `RAM`.

### Coster pre-requisites

- `.NET Core SDK 2.2`

### Coster usage

You should paste the `JSON` pricing files generated by the `Parser` in the `Pricing/` folder.

In `Release` mode:

```posh
cd .\coster\src\AzureVmCoster
dotnet run --configuration Release -- <path>
```

In `Debug` mode

```posh
λ  cd .\coster\src\AzureVmCoster
λ  dotnet run --configuration Debug
Input file path:
```

You'll need to provide the `<path>` when prompted.

`<path>` should point to a `CSV` file with the following fields:

- `Region`
- `Name`
- `CPU`
- `RAM` (in `GB`)
- `Operating System`

The columns can be in any order and the `CSV` file can contain extra-columns.

### Coster output

The `Coster` will generate a `CSV` file in the `Out/` directory with the following fields:

- `Region`
- `Name`
- `Operating System`
- `Instance`
- `CPU`
- `RAM`
- `Pay as You Go`
- `One Year Reserved`
- `Three Year Reserved`
- `Three Year Reverved with Azure Hybrid Benefit`
